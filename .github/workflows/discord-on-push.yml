name: Discord notify on main

on:
  push:
    branches:
      - main

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Send message to Discord
        env:
          DISCORD_WEBHOOK_URL: ${{ secrets.DISCORD_WEBHOOK_URL }}

          # Replace these with your server's emoji codes:
          # Example animated: <a:alert:123456789012345678>
          # Example normal: <:check:123456789012345678>
          EMOJI_ALERT: "<a:alert:123456789012345678>"
          EMOJI_ROCKET: "üöÄ"
          EMOJI_BRANCH: "üåø"
          EMOJI_COMMIT: "üß©"
          EMOJI_AUTHOR: "üßë‚Äçüíª"

          REPO: ${{ github.repository }}
          BRANCH: ${{ github.ref_name }}
          COMMIT_MSG: ${{ github.event.head_commit.message }}
          COMMIT_URL: ${{ github.event.head_commit.url }}
          AUTHOR: ${{ github.event.head_commit.author.name }}
          SHORT_SHA: ${{ github.sha }}
        run: |
          short_sha="${SHORT_SHA:0:7}"

          payload=$(cat <<JSON
          {
            "content": "${EMOJI_ALERT} ${EMOJI_ROCKET} **New push to \`${REPO}\`**\n${EMOJI_BRANCH} Branch: **\`${BRANCH}\`**\n${EMOJI_AUTHOR} Author: **${AUTHOR}**\n${EMOJI_COMMIT} Commit: **\`${short_sha}\`** - ${COMMIT_MSG}\nüîó ${COMMIT_URL}"
          }
          JSON
          )

          curl -H "Content-Type: application/json" \
               -d "$payload" \
               "$DISCORD_WEBHOOK_URL"
